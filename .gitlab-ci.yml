stages:
  - build
  - deploy
  - package
  - test

build-fedora:
  image: fedora:latest
  stage: build
  except:
    - tags
  before_script:
    - dnf update -y --nogpgcheck
    - dnf -y install --nogpgcheck
      gawk gettext-devel glib2-devel gobject-introspection-devel gtk-doc perl
      texinfo texinfo-tex
  script:
    - ./autogen.sh --disable-dependency-tracking
    - make
    - make install
    - make distcheck

deploy-install:
    stage: deploy
    needs: ["build-fedora"]
    script:
      - make install

package-distcheck:
    stage: package
    needs: ["build-fedora"]
    script:
      - make distcheck


test-examples:
    stage: test
    needs: ["build-fedora"]
    script:
      - ./examples/affinity
      - ./examples/df
      - ./examples/diskio
      - ./examples/first
      - ./examples/free
      - ./examples/mountlist
      - ./examples/netlist
      - ./examples/netload
      - ./examples/openfiles
      - ./examples/pprint
      - ./examples/procargs
      - ./examples/proclist
      - ./examples/procmap
      - ./examples/second
      - ./examples/smp
      - ./examples/sysdeps
      - ./examples/timings
      - ./examples/wd

